name: Aggressive Keep Alive

on:
  schedule:
    # Ping every 5 minutes for more aggressive keep-alive
    - cron: '*/5 * * * *'
  workflow_dispatch:

jobs:
  multi-ping:
    runs-on: ubuntu-latest
    steps:
      - name: Multi-Endpoint Ping
        run: |
          echo "ğŸš€ Starting aggressive keep-alive sequence..."
          echo "â° Current time: $(date -u) UTC"
          
          # Multiple endpoints to ping
          HEALTH_URL="https://budget-planner-app-fj6j.onrender.com/health"
          MAIN_URL="https://budget-planner-app-fj6j.onrender.com/"
          
          success_count=0
          total_attempts=0
          
          # Ping health endpoint
          echo "ğŸ“¡ Pinging health endpoint..."
          total_attempts=$((total_attempts + 1))
          if curl -s --max-time 45 "$HEALTH_URL" > /dev/null; then
            echo "âœ… Health endpoint: SUCCESS"
            success_count=$((success_count + 1))
          else
            echo "âŒ Health endpoint: FAILED"
          fi
          
          # Wait a moment
          sleep 2
          
          # Ping main page
          echo "ğŸ“¡ Pinging main page..."
          total_attempts=$((total_attempts + 1))
          if curl -s --max-time 45 "$MAIN_URL" > /dev/null; then
            echo "âœ… Main page: SUCCESS"
            success_count=$((success_count + 1))
          else
            echo "âŒ Main page: FAILED"
          fi
          
          # Report results
          echo "ğŸ“Š Results: $success_count/$total_attempts endpoints responded"
          
          if [ $success_count -gt 0 ]; then
            echo "âœ… At least one endpoint is healthy - app is alive"
          else
            echo "âŒ All endpoints failed - this needs investigation"
            exit 1
          fi
          
          echo "ğŸ¯ Aggressive keep-alive completed successfully"

      - name: Log Performance
        if: always()
        run: |
          echo "ğŸ¯ Aggressive Keep-Alive Report:"
          echo "   â€¢ Frequency: Every 5 minutes"
          echo "   â€¢ Endpoints: 2 (health + main)"
          echo "   â€¢ Strategy: Multi-ping redundancy"
          echo "   â€¢ Run ID: ${{ github.run_id }}"
          echo "   â€¢ Time: $(date -u) UTC"
